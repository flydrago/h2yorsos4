<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.h2y.os.dao.read.ICouponsUserRtDaoR">

	<resultMap type="com.h2y.os.entity.CouponsUserRt" id="couponsuserrtDaoMap">
		<result property="id" column="id" javaType="long" jdbcType="BIGINT" />
		<result property="claimCode" column="claim_code" javaType="string" jdbcType="VARCHAR" />
		<result property="couponsId" column="coupons_id" javaType="long" jdbcType="BIGINT" />
		<result property="couponsCode" column="coupons_code" javaType="string" jdbcType="VARCHAR" />
		<result property="account" column="account" javaType="string" jdbcType="VARCHAR" />
		<result property="status" column="status" javaType="int" jdbcType="INTEGER" />
		<result property="createDate" column="create_date" javaType="date" jdbcType="TIMESTAMP" />
		<result property="useDate" column="use_date" javaType="date" jdbcType="TIMESTAMP" />
		<result property="memo" column="memo" javaType="string" jdbcType="VARCHAR" />
		<result property="sourceCode" column="source_code" javaType="string" jdbcType="VARCHAR" />
		<result property="orderNo" column="order_no" javaType="string" jdbcType="VARCHAR" />
		<result property="str1" column="str_1" javaType="string" jdbcType="VARCHAR" />
		<result property="str2" column="str_2" javaType="string" jdbcType="VARCHAR" />
		<result property="str3" column="str_3" javaType="string" jdbcType="VARCHAR" />
		<result property="date1" column="date_1" javaType="date" jdbcType="TIMESTAMP" />
		<result property="date2" column="date_2" javaType="date" jdbcType="TIMESTAMP" />
		<result property="int1" column="int_1" javaType="int" jdbcType="INTEGER" />
		<result property="int2" column="int_2" javaType="int" jdbcType="INTEGER" />
		<result property="double1" column="double_1" javaType="double" jdbcType="DOUBLE" />
		<result property="double2" column="double_2" javaType="double" jdbcType="DOUBLE" />
	</resultMap>

	<select id="get" parameterType="long"
		resultMap="couponsuserrtDaoMap">
		select * from tb_coupons_user_rt where id = #{id}
	</select>

	
	<!-- 根据订单号获取优惠券-->
	<select id="getCouponsUserRtByOrderNo" parameterType="string" resultMap="couponsuserrtDaoMap">
		select * from tb_coupons_user_rt where order_no = #{orderNo} and status = 1
	</select>
	
	
	<select id="getCouponsBySourceCode" parameterType="hashmap" resultType="long">
		select u.id
				from tb_coupons_source_rt r,tb_coupons_source s,tb_coupons_user_rt u
				where  s.id = r.source_id
				and s.source_code=#{sourceCode}
				and s.start_date &lt;= now() and s.end_date  &gt;= now()
				and s.status=0  and r.status=0
				and u.coupons_id=r.coupons_id
				and u.account=#{account}
	</select>
	
	
</mapper>